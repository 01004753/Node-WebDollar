import InterfaceBlockchainBlock from "../../../common/blockchain/interface-blockchain/blocks/Interface-Blockchain-Block";

var assert = require('assert')

import PPoWBlockchain from 'common/blockchain/ppow-blockchain/blockchain/PPoW-Blockchain'
import PPoWBlockchainBlock from 'common/blockchain/ppow-blockchain/blocks/PPoW-Blockchain-Block'
import consts from 'consts/const_global'

describe('test PPoW-Blockchain interlink data structure', () => {

    let blockchain = null;
    let response = null;

    it('test blockchain ppow interlink', async () => {

        blockchain = new PPoWBlockchain();

        //values are optained from mining simulation :)
        let serialized = [
                    "006ab3380dead5fa330fc3c22f573b7fe872c4e92c78d9eec438faaa609841150000000300017bb3e84e6892c7e76be2beedb94a1035b7f095d50b5462806b92be0cbccd31fa0005e1e81bd4fc49224b5c51ef9ac939a9bde5da06826f53e810726b3c330c958b934e8ccee19731972c8fc3bcd380c0f59b62aef3504d90a0c2986cf2ee022dd2e5759e5df6e0e2761359d30a8275058e299fcc0381534545f55cf43e41983f5d4c9456f10db1a01b2e8aab1e7a79aab25285577f10f0666e88daba63ee1bb364479a130001ffffffff7bb3e84e6892c7e76be2beedb94a1035b7f095d50b5462806b92be0cbccd31fa",
                    "0170a063c18625e95843dcdd198a3ab44006ba15aaeaae3fc20e8466b26da12a000000cf0001006ab3380dead5fa330fc3c22f573b7fe872c4e92c78d9eec438faaa609841150005e1e8a28a0e16eb31c46119d52c1d421a9157f0fa1ab7d38dafe18910b874a04625accee19731972c8fc3bcd380c0f59b62aef3504d90a0c2986cf2ee022dd2e5759e5df6e0e2761359d30a8275058e299fcc0381534545f55cf43e41983f5d4c9456bb551471275b3e82811c1519c2eefb16282cce81979a3703beb85c6447ee59c40001ffffffff7bb3e84e6892c7e76be2beedb94a1035b7f095d50b5462806b92be0cbccd31fa",
                    "023219f69826205bbce56286e0793c88e2a058964497ad5aba9b8ca593b5e7f90000004300010170a063c18625e95843dcdd198a3ab44006ba15aaeaae3fc20e8466b26da12a0005e1e826e6d36308eb334ba1ac00711564432014efa37b227cccaade7d4189d3484585cee19731972c8fc3bcd380c0f59b62aef3504d90a0c2986cf2ee022dd2e5759e5df6e0e2761359d30a8275058e299fcc0381534545f55cf43e41983f5d4c94569a7ca6a3a4482838f49355a6a7e2fa7727d566ef7fc959042e7c16aa778260ee0001ffffffff7bb3e84e6892c7e76be2beedb94a1035b7f095d50b5462806b92be0cbccd31fa",
                    "00b76aa01f0276d8d456fefd5e68c35157427daabf6c6519001a79971758b17c000000240001023219f69826205bbce56286e0793c88e2a058964497ad5aba9b8ca593b5e7f90005e1e9301153ed13cf86e6250c0837db78c0c02a17c13c7ea1158faa007eb6788309f5cee19731972c8fc3bcd380c0f59b62aef3504d90a0c2986cf2ee022dd2e5759e5df6e0e2761359d30a8275058e299fcc0381534545f55cf43e41983f5d4c945649325f7af52ea60d66cd538baccedfd9ad000cdddc5b7e79ec3a1f5b065562dd0001ffffffff7bb3e84e6892c7e76be2beedb94a1035b7f095d50b5462806b92be0cbccd31fa",
                    "003516c9baeba060338e85152264c979ae5cc368afd6a49428a91a148fd636ff00000018000100b76aa01f0276d8d456fefd5e68c35157427daabf6c6519001a79971758b17c0005e1e96f357e61609f2c4ce26176a770df0fd9396eff71316c7d400b6307ddfea877accee19731972c8fc3bcd380c0f59b62aef3504d90a0c2986cf2ee022dd2e5759e5df6e0e2761359d30a8275058e299fcc0381534545f55cf43e41983f5d4c945666ac4f30c54d6adf4f659403d40614d351bfa5a3d500f1b96ef639090aa5c6510001ffffffff7bb3e84e6892c7e76be2beedb94a1035b7f095d50b5462806b92be0cbccd31fa",
                    "0063d9bf75e6c4c784bdaa1dfaaa373385b97783d1827d804a1a3d173f68434f000001320001003516c9baeba060338e85152264c979ae5cc368afd6a49428a91a148fd636ff0005e1e95a2cb999d80a9787e45ef520ed23112fed950e18c98caa1cf240555e9926cfd4cee19731972c8fc3bcd380c0f59b62aef3504d90a0c2986cf2ee022dd2e5759e5df6e0e2761359d30a8275058e299fcc0381534545f55cf43e41983f5d4c94563e93ee6f168054451a37fe98c80a7c1e96b3fafb3366f4545bb1604feddc8dfa0001ffffffff7bb3e84e6892c7e76be2beedb94a1035b7f095d50b5462806b92be0cbccd31fa",
                    "014ee549a170673e37c670c43a3afddf94a5f3eff0274d509f4731f11678fabc000000a600010063d9bf75e6c4c784bdaa1dfaaa373385b97783d1827d804a1a3d173f68434f0005e1e9a7140b4ec083c9580930510d16f925fca72dce111baf08021594f2300d2b1826cee19731972c8fc3bcd380c0f59b62aef3504d90a0c2986cf2ee022dd2e5759e5df6e0e2761359d30a8275058e299fcc0381534545f55cf43e41983f5d4c9456849ea604058ec5cb2b8719162ca850c45ccc6dc12f8c85513bfa651521d5c19e0001ffffffff7bb3e84e6892c7e76be2beedb94a1035b7f095d50b5462806b92be0cbccd31fa",
                    "0132ec0f582fb3dc17649a95bbd195b2e888b94f268bee25740970d7b63621cb000000180001014ee549a170673e37c670c43a3afddf94a5f3eff0274d509f4731f11678fabc0005e1ea282f21c75eaf2c4135d71d6a215f9e42d6978b9ec711dac0b4b1a9114d9a61d0cee19731972c8fc3bcd380c0f59b62aef3504d90a0c2986cf2ee022dd2e5759e5df6e0e2761359d30a8275058e299fcc0381534545f55cf43e41983f5d4c9456a6ff8a70adce9d5c52c33f12e859f30cce93db4f08d65fa2f908f5164e1ed94c0001ffffffff7bb3e84e6892c7e76be2beedb94a1035b7f095d50b5462806b92be0cbccd31fa",
                    "02b53f97dd0086c872f8d62346cfea8ce8ec8aed71c7feaf3ac235adbbf40df50000000200010132ec0f582fb3dc17649a95bbd195b2e888b94f268bee25740970d7b63621cb0005e1ea0b7823747d989d164d00166f37352744e37bfd349500f701cc613c2b33f7fc4ccee19731972c8fc3bcd380c0f59b62aef3504d90a0c2986cf2ee022dd2e5759e5df6e0e2761359d30a8275058e299fcc0381534545f55cf43e41983f5d4c94568ffc07ab8b93fadea3bd0f27a0f16fa2efa0da6e5b91e28b2007231d715a3fb40001ffffffff7bb3e84e6892c7e76be2beedb94a1035b7f095d50b5462806b92be0cbccd31fa",
                    "026aaa480be5687f4344796340b11cda73aa1b560688517b1a81d3cc74bcdbf1000000a9000102b53f97dd0086c872f8d62346cfea8ce8ec8aed71c7feaf3ac235adbbf40df50005e1ea245581334fa2892308114170631de84981f199b071d986ef3cd08be73767df26cee19731972c8fc3bcd380c0f59b62aef3504d90a0c2986cf2ee022dd2e5759e5df6e0e2761359d30a8275058e299fcc0381534545f55cf43e41983f5d4c94563aefef98b2d1f7de37352f6ddea787bc4b059d5685c53373b3596b0fc0c070890001ffffffff7bb3e84e6892c7e76be2beedb94a1035b7f095d50b5462806b92be0cbccd31fa",
                    "02ef60f0549907eda19e571f536d22c590e772fe7ba585d06e4bb795bc80b7b7000000830001026aaa480be5687f4344796340b11cda73aa1b560688517b1a81d3cc74bcdbf10005e1ea2eb24a09bb53b362a81c00800c41b4e87eea4c49410d30a32f71e02ec469d122cee19731972c8fc3bcd380c0f59b62aef3504d90a0c2986cf2ee022dd2e5759e5df6e0e2761359d30a8275058e299fcc0381534545f55cf43e41983f5d4c945671a867b242cbe55463ef9fe18201a0b7e83fe6e2ff320ffc5a4cce943301ab2b0001ffffffff7bb3e84e6892c7e76be2beedb94a1035b7f095d50b5462806b92be0cbccd31fa",
                    "018a8b469ce93971da24505e29731d3cf57760236b21e3bbbf7d2e641c94bffa00000055000102ef60f0549907eda19e571f536d22c590e772fe7ba585d06e4bb795bc80b7b70005e1eb0af55ef532b481035ab853883be3615c2f0623dbde9f4cf7a1706fee1381a8b1cee19731972c8fc3bcd380c0f59b62aef3504d90a0c2986cf2ee022dd2e5759e5df6e0e2761359d30a8275058e299fcc0381534545f55cf43e41983f5d4c9456754ee2be42c9d39bbfad8d9d029aae5d31eeba4816ff7b605b29777122f444620001ffffffff7bb3e84e6892c7e76be2beedb94a1035b7f095d50b5462806b92be0cbccd31fa"
                    ];

        //create a dummy block and deserialize from serialized array
        
        for (let i = 0; i < 1; ++i) {
            let block = new PPoWBlockchainBlock( blockchain, 0x01, new Buffer(consts.BLOCKS_POW_LENGTH), new Buffer(consts.BLOCKS_POW_LENGTH), undefined, undefined, undefined, 0, blockchain.db );
            let buffer = new Buffer(serialized[i], 'hex');

            block.deserializeBlock(buffer, 0);
            blockchain.includeBlockchainBlock(block, false, false, false);
        }

        //check if links point correctly
        for (let i = 0; i < blockchain.blocks.length; ++i){
            let block = blockchain.blocks[i];
            console.log('B.height=', block.height, block.interlink.length);
            for (let j = 0; j < block.interlink.length; ++j){
                let link = block.interlink[i];
                console.log('height=', link.height);
                console.log('blockId=', link.blockId);
                assert(blockchain.blocks[link.height].hash.equals(link.blockId));
            }
        }

    });

});
